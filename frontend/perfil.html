<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piratas del Cine</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="Home">
    <header class="cabezal">
        <section>
            <div class="presentacion">
                <img src="./imagenes/cine.png" alt="imagen" width="200px">
                <h1 id="titulo">Piratas del Cine</h1>                
            </div>

            <div class ="ingresar" id="ingresar">
                <a href="inicio_registro.html" class="boton">Iniciar Sesion</a>
            </div>
            
            <nav id="navegador_interno">
                <div class="icono_menu" onclick="desplegar()">☰</div>
                <div class="cuadro_interno" id="cuadro_interno">
                    <ul>
                        <li><a href="perfil.html">Perfil</a></li>
                        <li>
                            <button class="biblio" onclick="desplega_biblio()">Mi Biblioteca  <strong id="signo">&lt</strong></button>
                            <ul id="menu" hidden>
                                <li><a href="">Mis Series</a></li>
                                <li><a href="">MIs Peliculas</a></li>
                            </ul>
                        </li>
    
                        <li><a href="">Comentarios</a></li>
                        <li><button onclick="cerrarSesion()">Cerrar Sesion</button></li>
                    </ul>
                </div>

            </nav> 
        </section>    
        <section>
            <nav class="navegador">
                <div class="paginas">
                <a id="index" href="index.html">Home</a>
                <a href="Series.html">Series</a>
                <a href="Peliculas.html">Peliculas</a>
                </div>

                <div id="buscador">
                    <input type="text" id="search" placeholder="Buscar ...">
                    <span id="buscar">&#128269</span>
                </div>
            </nav>

        </section>
  
    </header>
	<main>
        <div class="cuadro resultados" id="cuadro">
            <h2 id="titulo_item">Perfil <span id="nombre_usuario"></span> </h2>
            <div id="perfil_detalles" class="formato_perfil">
                <div>
                    <h3>Datos Personales</h3>
                    <div id="datos_persona"class="datos">
                    </div>
                </div>
                <div>
                    <h3>Usuario</h3>
                    <div id="datos_usuario" class="datos">
                    </div>
                </div>

            </div> 
            <div id="botones" class="formato_perfil">
                <button id="editar_cuenta" class="editar_datos">Editar Perfil</button>
                <button id="borrar_cuenta" class="borrar">Eliminar cuenta</button>                        
            </div>
        </div>
        <div id="confirmar_accion">
            <h3>Estas seguro de <span id="palabra"></span> la cuenta?</h3>
            <button onclick="respuesta_resibida(true)">Aceptar</button>
            <button onclick="respuesta_resibida(false)">Cancelar</button>
        </div>
	</main>
    <footer class="footer">
            <p>&copy; 2024 The Ethical Pirates</p>
    </footer>yhuuu6t
    <script src="../backend/server.js"></script>
    <script src="./js/interacciones.js"></script>
    <script src="./js/series_peliculas.js"></script>
    <script src="./js/sesion_verificar.js"></script>
    <script>
        
        const parametro = new URLSearchParams(window.location.search);
        const nombre = parametro.get('cuenta');
        // codificacion por los espacios en el nombre
        const us = document.getElementById('nombre_usuario');
        const datos_pers = document.getElementById('datos_persona');
        const datos_us = document.getElementById('datos_usuario');
        fetch("http://localhost:3000/api/v1/cuentas/" + nombre)
        .then(res => res.json())
        .then(user =>{
            us.innerText = user.nombre_usuario;
            const nombre= document.createElement('p'); 
            nombre.innerText= `Nombre/s: ${user.nombre}`;
            datos_pers.appendChild(nombre);
            const apellido= document.createElement('p'); 
            apellido.innerText= `Apellido/s: ${user.apellido}`;
            datos_pers.appendChild(apellido);
            const fecha= document.createElement('p'); 
            fecha.innerText= `Fecha de nacimeinto: ${user.fecha_nacimiento}`;
            datos_pers.appendChild(fecha);
            const genero= document.createElement('p'); 
            genero.innerText= `Genero: ${user.genero}`;
            datos_pers.appendChild(genero);
            const email= document.createElement('p'); 
            email.innerText= `Correo electronico: ${user.email? user.email:"agregar correo"}`;
            datos_pers.appendChild(email);
            const tel= document.createElement('p'); 
            tel.innerText= `Telefono: ${user.telefono? user.telefono: "agregar numero"}`;
            datos_pers.appendChild(tel);
            
            const usuario = document.createElement('p');
            usuario.innerText = `Nombre de Usuario: ${user.nombre_usuario}`;
            datos_us.appendChild(usuario);
            const contra = document.createElement('p');
            contra.innerText = `Contraseña: ************`;
            datos_us.appendChild(contra);
        })

        function mostrar_confirmacion(palabra){
            return new Promise((resolve)=>{
                const tipo = document.getElementById('palabra');
                const cuadro = document.getElementById('confirmar_accion');
                tipo.innerText= palabra;
                cuadro.style.display= 'block';
                //aqui veo que apretara el usuario
                window.confirmar_respuesta = resolve;
            });
        }

        function respuesta_resibida(desicion){
            const cuadro = document.getElementById('confirmar_accion');
            cuadro.style.display = 'none';
            window.confirmar_respuesta(desicion);
        }

        async function editar_cuenta() {
            const desicion= await mostrar_confirmacion("editar");
            if (desicion){
                // vacio valores anteriores
                datos_pers.innerHTML='';
                datos_us.innerHTML='';
                const botones= document.getElementById('botones');
                botones.innerHTML='';
                //input para nombre y apellido
                const text_nombre = document.createElement('h4');
                text_nombre.innerText= 'Nombre:';
                const nombre = document.createElement('input');
                nombre.type="text";
                nombre.placeholder="ej: Ariel";
                datos_pers.appendChild(text_nombre);
                datos_pers.appendChild(nombre);

                const text_apell = document.createElement('h4');
                text_apell.innerText= 'Apellido:';
                const apellido = document.createElement('input');
                apellido.type="text";
                apellido.placeholder="ej: Torres";
                datos_pers.appendChild(text_apell);
                datos_pers.appendChild(apellido);

                //input para genero
                const text_gen = document.createElement('h4');
                text_gen.innerText= 'Genero';
                const genero = document.createElement('select');
                const no_opcion= document.createElement('option');
                const opcion1 = document.createElement('option');
                const opcion2 = document.createElement('option');
                const opcion3 = document.createElement('option');
                no_opcion.innerText= "Seleccione su Genero";
                genero.appendChild(no_opcion);
                opcion1.value="Otro";
                opcion1.innerText= "Otro";
                genero.appendChild(opcion1);

                opcion2.value="Femenino";
                opcion2.innerText= "Femenino";
                genero.appendChild(opcion2);

                opcion3.value="Masculino";
                opcion3.innerText= "Masculino";
                genero.appendChild(opcion3);
                datos_pers.appendChild(text_gen);
                datos_pers.appendChild(genero);

                //input para email
                const text_email = document.createElement('h4');
                text_email.innerText= 'Email:';
                const email = document.createElement('input');
                email.type='email';
                email.placeholder= 'ej: aviondisparadoenelcielo@gmail.ar';
                datos_pers.appendChild(text_email);
                datos_pers.appendChild(email);

                //input para telefono
                const text_tel = document.createElement('h4');
                text_tel.innerText= 'Numero de Telefono: ';
                const tel = document.createElement('input');
                tel.type='tel';
                tel.placeholder= 'ej: 15 12345678';
                datos_pers.appendChild(text_tel)
                datos_pers.appendChild(tel);

                //input para cambiar contraseña
                const text_clave1 = document.createElement('h5');
                text_clave1.innerText= 'Verificar contraseña actual';
                const contra_actual = document.createElement('input');
                const text_clave2 = document.createElement('h5');
                text_clave2.innerText= 'Verificar contraseña actual';
                const contra_nueva = document.createElement('input');
                contra_actual.type= "password";
                contra_nueva.type= "password";
                contra_actual.placeholder='Contraseña actual';
                contra_nueva.placeholder= 'Contraseña nueva';
                datos_us.appendChild(text_clave1);
                datos_us.appendChild(contra_actual);
                datos_us.appendChild(text_clave2);
                datos_us.appendChild(contra_nueva);

                const boton_cambios = document.createElement('button');
                boton_cambios.classList.add('editar');
                boton_cambios.innerText="Confirmar cambios";
                botones.appendChild(boton_cambios);
                const boton_cancelar = document.createElement('button');
                boton_cancelar.classList.add('salir');
                boton_cancelar.innerText="Cancelar";
                botones.appendChild(boton_cancelar);
            }
        }

        document.getElementById('editar_cuenta').addEventListener('click', editar_cuenta);
        document.getElementById('borrar_cuenta').addEventListener('click', Borrar_cuenta);

    </script>
</body>
</html>